<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小红书采集器配置</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <style>
    .container { 
      max-width: 800px; 
      margin: 2rem auto; 
      padding: 0 1rem; 
    }
    .toast { 
      position: fixed; 
      top: 1rem; 
      right: 1rem;
      padding: 1rem;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1000;
    }
    .toast.success { background: #28a745; }
    .toast.error { background: #dc3545; }
    .toast.hide { display: none; }
    .config-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .config-help {
      font-size: 0.875rem;
      color: #6c757d;
      margin-top: 0.5rem;
    }
    .btn-test {
      background: #17a2b8;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 1rem;
    }
    .btn-test:hover {
      background: #138496;
    }
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 0.5rem;
    }
    .status-connected { background: #28a745; }
    .status-disconnected { background: #dc3545; }
    .status-testing { background: #ffc107; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>🔧 飞书配置</h1>
      <p>配置小红书笔记采集器的飞书多维表格连接信息</p>
    </header>
    
    <main>
      <section class="config-section">
        <h2>基础配置</h2>
        <form id="configForm">
          <label for="spreadsheetUrl">
            多维表格 URL
            <input 
              type="url" 
              id="spreadsheetUrl" 
              name="spreadsheetUrl" 
              required 
              placeholder="https://www.feishu.cn/sheets/xxxxxxxx"
            />
            <div class="config-help">
              粘贴完整的飞书多维表格链接，系统将自动解析 App Token 和 Table ID
            </div>
          </label>
          
          <label for="appId">
            飞书应用 App ID
            <input 
              type="text" 
              id="appId" 
              name="appId" 
              required
              placeholder="cli_a1b2c3d4e5f6g7h8"
            />
            <div class="config-help">
              在飞书开放平台创建应用后获取的 App ID
            </div>
          </label>
          
          <label for="appSecret">
            飞书应用 App Secret
            <input 
              type="password" 
              id="appSecret" 
              name="appSecret" 
              required
              placeholder="xxxxxxxxxxxxxxxx"
            />
            <div class="config-help">
              在飞书开放平台应用详情页获取的 App Secret
            </div>
          </label>
          
          <div style="margin-top: 2rem;">
            <button type="submit" id="saveBtn">💾 保存配置</button>
            <button type="button" id="testBtn" class="btn-test">🔗 测试连接</button>
            <span id="connectionStatus" style="margin-left: 1rem;">
              <span class="status-indicator status-disconnected"></span>
              未连接
            </span>
          </div>
        </form>
      </section>
      
      <section class="config-section">
        <h2>使用说明</h2>
        <h3>如何获取配置信息？</h3>
        <ol>
          <li><strong>多维表格 URL</strong>：打开飞书多维表格，复制完整的浏览器地址栏链接</li>
          <li><strong>App ID</strong>：在飞书开放平台创建应用后，从应用凭证页面获取</li>
          <li><strong>App Secret</strong>：在飞书开放平台应用详情页的凭证管理中获取</li>
        </ol>
        
        <h3>支持的URL格式</h3>
        <p>系统支持以下飞书多维表格URL格式，会自动解析App Token和Table ID：</p>
        
        <h4>格式1：多维表格格式（推荐）</h4>
        <pre><code>https://your-domain.feishu.cn/base/APP_TOKEN?table=TABLE_ID</code></pre>
        
        <h4>格式2：电子表格格式</h4>
        <pre><code>https://www.feishu.cn/sheets/APP_TOKEN?table=TABLE_ID</code></pre>
        
        <h4>格式3：带视图参数</h4>
        <pre><code>https://your-domain.feishu.cn/base/APP_TOKEN?table=TABLE_ID&view=VIEW_ID</code></pre>
        
        <p>系统会自动解析并提取：</p>
        <ul>
          <li><strong>App Token</strong>：URL路径中的 <code>APP_TOKEN</code> 部分</li>
          <li><strong>表格 ID</strong>：查询参数中的 <code>table=TABLE_ID</code> 部分</li>
        </ul>
        
        <div class="config-help">
          <strong>提示：</strong>直接复制浏览器地址栏的完整URL即可，系统会自动提取所需信息。
        </div>
        
        <h3>飞书应用创建步骤</h3>
        <ol>
          <li>访问飞书开放平台 (<code>open.feishu.cn</code>)</li>
          <li>创建企业自建应用</li>
          <li>在权限管理中添加<strong>多维表格</strong>相关权限</li>
          <li>获取 App ID 和 App Secret</li>
        </ol>
      </section>
      
      <section class="config-section">
        <h2>高级设置</h2>
        <label for="baseUrl">
          飞书 API 基础 URL
          <input 
            type="text" 
            id="baseUrl" 
            name="baseUrl" 
            value="https://open.feishu.cn"
          />
          <div class="config-help">
            一般情况下不需要修改，除非使用自定义API endpoint
          </div>
        </label>
        
        <label for="timeout">
          请求超时时间 (毫秒)
          <input 
            type="number" 
            id="timeout" 
            name="timeout" 
            value="10000"
            min="1000"
            max="60000"
          />
          <div class="config-help">
            网络请求的超时时间，建议设置为 10-30 秒
          </div>
        </label>
      </section>
    </main>
    
    <footer>
      <div id="toast" class="toast hide"></div>
    </footer>
  </div>
  
  <script src="./options.ts" type="module"></script>
</body>
</html>