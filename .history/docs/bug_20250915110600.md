// ===== 修复配置选择器问题 =====
// 1. 确保模态窗口HTML正确注入
@@ -src/popup/popup.html
<div class="popup-container">
  <!-- 在容器内添加配置模态窗口 -->
  <div id="config-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>飞书配置</h3>
      <!-- 配置表单内容 -->
    </div>
  </div>
  
  <!-- 原有内容 -->
</div>

// 2. 添加模态窗口控制逻辑
@@ -src/popup/popup.ts
// 初始化模态窗口
function initConfigModal() {
  const modal = document.getElementById('config-modal');
  if (!modal) return;
  
  const closeButton = modal.querySelector('.close');
  if (!closeButton) return;
  
  // 打开模态窗口
  document.getElementById('config-button').addEventListener('click', () => {
    modal.style.display = 'block';
    loadConfigForm(); // 加载配置表单
  });
  
  // 关闭模态窗口
  closeButton.addEventListener('click', () => {
    modal.style.display = 'none';
  });
  
  // 点击外部关闭
  window.addEventListener('click', (event) => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });
}

// 在DOMContentLoaded中调用
document.addEventListener('DOMContentLoaded', () => {
  initConfigModal();
  // 其他初始化...
});

// 3. 添加表单加载逻辑
@@ -src/popup/popup.ts
function loadConfigForm() {
  const formContainer = document.getElementById('config-form-container');
  if (!formContainer) return;
  
  // 清空现有内容
  formContainer.innerHTML = '';
  
  // 动态生成表单
  const formHTML = `
    <form id="feishu-config-form">
      <div class="form-group">
        <label for="config-name">配置名称</label>
        <input type="text" id="config-name" required>
      </div>
      <!-- 其他表单字段 -->
      <button type="submit" class="btn-save">保存配置</button>
    </form>
  `;
  
  formContainer.innerHTML = formHTML;
  
  // 添加表单提交处理
  document.getElementById('feishu-config-form')?.addEventListener('submit', saveConfig);
}

// ===== 修复图标显示问题 =====
// 1. 添加图标加载检查
@@ -src/popup/popup.html
<!-- 添加测试图标 -->
<div style="position:absolute; top:-100px; left:-100px;">
  
</div>

// 2. 更新图标引用方式
@@ -src/popup/popup.html
<!-- 使用内联SVG引用 -->
<button id="config-button">
  <svg width="24" height="24" viewBox="0 0 24 24">
    <use href="assets/icons.svg#config"></use>
  </svg>
</button>

// 3. 创建SVG精灵文件
+++ src/assets/icons.svg
<svg xmlns="http://www.w3.org/2000/svg" style="display:none">
  <symbol id="config" viewBox="0 0 24 24">
    <!-- 配置图标SVG路径 -->
    <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
  </symbol>
  <!-- 其他图标定义 -->
</svg>

// 4. 添加CSS修复
@@ -src/popup/popup.css
/* 确保SVG正确显示 */
button svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

button:hover svg {
  fill: #4285f4;
}

// ===== 添加终极调试功能 =====
// 1. 创建调试面板
@@ -src/popup/popup.html
<!-- 添加调试面板 -->
<div id="debug-panel" style="position:fixed; bottom:10px; right:10px; background:rgba(0,0,0,0.7); color:white; padding:10px; z-index:1000; display:none;">
  <h4>调试信息</h4>
  <div id="debug-content"></div>
</div>

// 2. 添加调试控制台
@@ -src/popup/popup.ts
function initDebugTools() {
  // Ctrl+Shift+D 打开调试面板
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
      const panel = document.getElementById('debug-panel');
      if (panel) panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }
  });
  
  // 收集调试信息
  setInterval(() => {
    const debugContent = document.getElementById('debug-content');
    if (!debugContent) return;
    
    const info = {
      timestamp: new Date().toISOString(),
      configLoaded: !!document.getElementById('config-modal'),
      iconsLoaded: !!document.querySelector('svg use'),
      // 其他调试信息
    };
    
    debugContent.innerHTML = JSON.stringify(info, null, 2);
  }, 1000);
}

// 在初始化中调用
document.addEventListener('DOMContentLoaded', () => {
  initDebugTools();
  // 其他初始化...
});